<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bletting Manager</title>
    <link rel="stylesheet" href="css/main.css">

    <style>
        /* ❌ Запрет выделения текста на экране "Общий план" */
        .content-body,
        svg,
        svg text {
          user-select: none;
          -webkit-user-select: none;
          -ms-user-select: none;
        }
    </style>

</head>
<body>
<script>
    if (localStorage.getItem('isAuthenticated') !== 'true') {
      window.location.href = 'index.html';
    }
</script>


<div class="app">

    <!-- ЛЕВАЯ ПАНЕЛЬ -->
    <aside class="sidebar">
        <div class="logo">
            <img src="assets/logo.png" alt="Logo">
        </div>

        <nav class="menu">
            <div class="menu-item active">
                <span class="icon"><img src="icons/mnemo.png"></span>
                <span>Мнемосхемы</span>
            </div>
            <div class="menu-item">
                <span class="icon"><img src="icons/graf.png"></span>
                <span>Графики</span>
            </div>
            <div class="menu-item">
                <span class="icon"><img src="icons/anal.png"></span>
                <span>Аналитика</span>
            </div>
            <div class="menu-item">
                <span class="icon"><img src="icons/soob.png"></span>
                <span>Сообщения</span>
            </div>
            <div class="menu-item danger">
                <span class="icon"><img src="icons/warn.png"></span>
                <span>Аварии</span>
            </div>
        </nav>
    </aside>

    <!-- ОСНОВНОЕ -->
    <main class="content">

        <!-- ВЕРХНЯЯ ПАНЕЛЬ -->
        <div class="top-bar">
            <div class="top-left">
                <span class="page-title">Общий план</span>
            </div>
            <div class="top-right">
                <button class="top-btn">
                    <img src="icons/refresh.png">
                    <span>Обновить</span>
                </button>
                <div class="date-box">
                    <img src="icons/calendar.png">
                    <span id="dateTime">--</span>
                </div>
                <button class="icon-btn"><img src="icons/settings.png"></button>
                <button class="icon-btn" id="userBtn"><img src="icons/user.png"></button>
                <div class="user-popup" id="userPopup">
                    <div class="user-name">
                        Пользователь: <b id="currentUser">admin</b>
                    </div>
                    <button class="logout-btn" id="logoutBtn">Выйти</button>
                </div>
            </div>
        </div>

        <!-- МНЕМОСХЕМА -->
        <div class="content-body">

            <svg viewBox="0 0 1200 800" width="100%" height="100%">

                <!-- ===== СТИЛИ SVG ===== -->
                <style>
                    .camera {
                      stroke: #3b3f44;
                      stroke-width: 2.5;
                      cursor: pointer;
                      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.35));
                    }

                    .camera.active {
                      filter:
                        drop-shadow(0 0 14px rgba(255,255,255,0.75))
                        brightness(1.08);
                    }

                    /* Цвета камер */
                    .cam-yellow { fill: #f4f48a; }
                    .cam-green  { fill: #9af59a; }
                    .cam-cyan   { fill: #9feff5; }
                    .cam-purple { fill: #e6c6ff; }
                    .cam-orange { fill: #f2d28a; }

                    /* Температура */
                    .temp-box {
                      fill: #dedede;
                      stroke: #2c2f33;
                      stroke-width: 2;
                      rx: 6;
                      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.45));
                    }

                    .temp-text {
                      fill: #111;
                      font-size: 17px;
                      font-weight: 600;
                      text-anchor: middle;
                      dominant-baseline: middle;
                      pointer-events: none;
                    }
                </style>

                <!-- ===== ФОН ===== -->
                <rect x="0" y="0" width="1200" height="800" fill="#2e3238"/>

                <!-- ===== КОРИДОР (НЕ КЛИКАБЕЛЬНЫЙ) ===== -->
                <rect x="560" y="50" width="80" height="700" fill="#9a9a9a"/>

                <!-- ===== СТЕНА ===== -->
                <rect x="10" y="300" width="200" height="100" fill="#9a9a9a"/>

                <!-- ===== КАМЕРЫ ===== -->

                <!-- G-1 -->
                <rect class="camera cam-yellow" x="10" y="50" width="200" height="250" rx="0"/>
                <rect class="temp-box" x="65" y="150" width="90" height="34"/>
                <text class="temp-text" x="110" y="167">21.4 °C</text>
                <text x="110" y="230" fill="#222" font-weight="600" text-anchor="middle">G-1</text>

                <!-- G-2 -->
                <rect class="camera cam-green" x="358" y="50" width="200" height="300" rx="0"/>
                <rect class="temp-box" x="413" y="170" width="90" height="34"/>
                <text class="temp-text" x="458" y="187">7.2 °C</text>
                <text x="458" y="260" fill="#222" font-weight="600" text-anchor="middle">G-2</text>

                <!-- G-3 -->
                <rect class="camera cam-green" x="358" y="360" width="200" height="300" rx="0"/>
                <rect class="temp-box" x="413" y="480" width="90" height="34"/>
                <text class="temp-text" x="458" y="497">—</text>
                <text x="458" y="560" fill="#222" font-weight="600" text-anchor="middle">G-3</text>

                <!-- C-1 -->
                <rect class="camera cam-yellow" x="10" y="400" width="200" height="250" rx="0"/>
                <rect class="temp-box" x="65" y="520" width="90" height="34"/>
                <text class="temp-text" x="110" y="537">—</text>
                <text x="110" y="610" fill="#222" font-weight="600" text-anchor="middle">C-1</text>

                <!-- C-2 -->
                <rect class="camera cam-cyan" x="642" y="50" width="190" height="250" rx="0"/>
                <rect class="temp-box" x="690" y="170" width="90" height="34"/>
                <text class="temp-text" x="735" y="187">7.7 °C</text>
                <text x="735" y="260" fill="#222" font-weight="600" text-anchor="middle">C-2</text>

                <!-- C-3 -->
                <rect class="camera cam-purple" x="950" y="50" width="245" height="210" rx="0"/>
                <rect class="temp-box" x="1027" y="140" width="90" height="34"/>
                <text class="temp-text" x="1072" y="157">6.3 °C</text>
                <text x="1072" y="210" fill="#222" font-weight="600" text-anchor="middle">C-3</text>

                <!-- C-4 -->
                <rect class="camera cam-purple" x="950" y="270" width="245" height="210" rx="0"/>
                <rect class="temp-box" x="1027" y="360" width="90" height="34"/>
                <text class="temp-text" x="1072" y="377">4.6 °C</text>
                <text x="1072" y="440" fill="#222" font-weight="600" text-anchor="middle">C-4</text>

            </svg>

        </div>
    </main>
</div>


<!-- ===== ЛОГИКА НАЖАТИЯ ===== -->
<script>
    const cameras = document.querySelectorAll('.camera');

    cameras.forEach(cam => {
      cam.addEventListener('mousedown', () => cam.classList.add('active'));
      cam.addEventListener('mouseup',   () => cam.classList.remove('active'));
      cam.addEventListener('mouseleave',() => cam.classList.remove('active'));
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {

      function updateDateTime() {
        const now = new Date();

        const months = [
          'января', 'февраля', 'марта', 'апреля',
          'мая', 'июня', 'июля', 'августа',
          'сентября', 'октября', 'ноября', 'декабря'
        ];

        const day = now.getDate();
        const month = months[now.getMonth()];
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');

        const text = `${day} ${month}, ${h}:${m}:${s}`;

        const el = document.getElementById('dateTime');
        if (el) {
          el.textContent = text;
        } else {
          console.error('Элемент #dateTime не найден');
        }
      }

      // сразу
      updateDateTime();

      // каждую секунду
      setInterval(updateDateTime, 1000);

    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {

      const userBtn = document.getElementById('userBtn');
      const userPopup = document.getElementById('userPopup');
      const logoutBtn = document.getElementById('logoutBtn');
      const currentUser = document.getElementById('currentUser');

      // текущий пользователь
      const user = localStorage.getItem('rememberLogin') || 'admin';
      currentUser.textContent = user;

      // открыть / закрыть popup
      userBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userPopup.classList.toggle('show');
      });

      // клик вне popup — закрыть
      document.addEventListener('click', () => {
        userPopup.classList.remove('show');
      });

      // выход
      logoutBtn.addEventListener('click', () => {

        localStorage.removeItem('isAuthenticated');

        window.location.href = 'index.html';
      });

    });
</script>
<!-- MQTT -->
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="js/mqtt.js"></script>


</body>
</html>
